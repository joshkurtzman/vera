<?xml version="1.0" encoding="ISO-8859-1"?>
<implementation>
<functions>

 function XantechStartup(lul_device)
    local ChildDevices = {}
   
    luup.log("starting device: " .. tostring(lul_device))
        
        -- Tell Vera that we are going start creating children --
        
   local rootdev = luup.chdev.start(lul_device)   
   local i = 1
   
	while 7 > i do
		if ChildDevices[tonumber(i)] == nil  then
			luup.chdev.append(lul_device, rootdev, string.format("Zone-%s", i), "SpeakerZone-" .. i , "urn:schemas-upnp-org:device:BinaryLight:1", "D_BinaryLight1.xml"
											,"" , "", false)
			 i = i + 1
		end
	end
	  -- Initialize Children --
	luup.log("Call  XANTECH initializeChildren")

for k, v in pairs(luup.devices) do
      if(v.device_num_parent == lul_device) then
        luup.log(string.format("Scanning luup.devices[%s(%s)]", tostring(k), type(k)))
          local zone = v.id:match("^Zone%-(%d+)$")
		  if(zone ~= nil) then
			  ChildDevices[tonumber(zone)] = k
		  else
					luup.log("Found unexpected Child #" .. v)
          end
	end
end


	-- Tell Vera we are done creating children --
	luup.log("Call CHDev Sync")
	luup.chdev.sync(lul_device, rootdev)
	 end
	  
	  
</functions>

 <startup>XantechStartup</startup>

 <actionList>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>OneOff</name>
	<button>1</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>OneOn</name>
	<button>2</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>OneToggle</name>
	<button>3</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>OneMomentary</name>
	<button>4</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>


<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>TwoOff</name>
	<button>5</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>TwoOn</name>
	<button>6</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>TwoToggle</name>
	<button>7</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>TwoMomentary</name>
	<button>8</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>

<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>ThreeOff</name>
	<button>9</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>ThreeOn</name>
	<button>10</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>ThreeToggle</name>
	<button>11</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0040 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0015 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>ThreeMomentary</name>
	<button>12</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>

<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FourOff</name>
	<button>13</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FourOn</name>
	<button>14</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FourToggle</name>
	<button>15</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FourMomentary</name>
	<button>16</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>

<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FiveOff</name>
	<button>17</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FiveOn</name>
	<button>18</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 0015 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FiveToggle</name>
	<button>19</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0015 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0040 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>FiveMomentary</name>
	<button>20</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>

<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>SixOff</name>
	<button>21</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0040 0016 05ef 0157 0055 0016 0e4b</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>SixOn</name>
	<button>22</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0040 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>SixToggle</name>
	<button>23</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0156 00ac 0015 0040 0016 0040 0016 0015 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0040 0016 0015 0015 0040 0016 0040 0016 0040 0015 0015 0016 0040 0015 0015 0016 0040 0015 0040 0016 0015 0015 0015 0016 0015 0016 0040 0016 0015 0016 0040 0016 0015 0016 0015 0015 0040 0016 0040 0016 0040 0015 05f0 0156 0056 0016 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>SixMomentary</name>
	<button>24</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0015 0016 0040 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0040 0015 0015 0016 0015 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>

<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>AllOff</name>
	<button>25</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>
<action>
	<serviceId>urn:micasaverde-com:serviceId:XANTECH</serviceId>
	<name>AllOn</name>
	<button>26</button>
	<remote>0</remote>
	<ir>0000 006c 0022 0002 0157 00ab 0016 0040 0016 0040 0015 0015 0016 0015 0016 0040 0016 0015 0016 0015 0015 0015 0016 0015 0016 0015 0015 0040 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 0040 0016 0040 0015 0040 0016 0015 0015 0040 0016 0015 0015 0015 0016 0015 0016 0015 0015 0015 0016 0015 0016 0040 0016 0015 0016 0040 0016 0040 0015 0040 0016 05ef 0157 0056 0015 0e4c</ir>
	<irtoggle></irtoggle>
</action>

  <action>
      <serviceId>urn:upnp-org:serviceId:SwitchPower1</serviceId>
      <name>SetTarget</name>
      <run>
        local zoneSet
		local zoneAltID = luup.attr_get('altid', lul_device)
		local ZoneNum = tonumber(zoneAltID:match("^Zone%-(%d+)$"))
		local c = {"One",  "Two", "Three", "Four", "Five", "Six" }
		
		local ParentID = tonumber(luup.attr_get('id_parent', lul_device))
     
		if(lul_settings.newTargetValue == "1") then
			local lul_resultcode, lul_resultstring, lul_job, lul_returnarguments = luup.call_action("urn:micasaverde-com:serviceId:XANTECH", c[ZoneNum] .. "On", {}, ParentID)
			luup.variable_set("urn:upnp-org:serviceId:SwitchPower1", "Status", 1, lul_device)
		else
			local ul_resultcode, lul_resultstring, lul_job, lul_returnarguments = luup.call_action("urn:micasaverde-com:serviceId:XANTECH", c[ZoneNum] .. "Off", {}, ParentID)
            luup.variable_set("urn:upnp-org:serviceId:SwitchPower1", "Status", 0, lul_device)
		end
		</run>
  </action>

  

</actionList>
</implementation>
